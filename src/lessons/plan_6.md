# Модуль 3

## Занятие 6:

- Ответы на вопросы
- Кахут
- Теория:
  - Методы жизненного цикла и HTTP-запросы
  - Состояние и компонент для индикатора загрузки
  - Состояние и компонент для обработки ошибки
  - Паттерн «State machine» для хранение статуса запроса
  - Утечка памяти при размонтировании компонента с активным HTTP-запросом

### Задача № 1

Используя [mockapi.io/](https://mockapi.io/) сделать `GET` запрос городами:

- удаляем логику подгрузки городов из локального хранилища
- пишем метод fetchCities, в котором делаем get-запрос по ендпоинту `cities`
- полученные города записывам в стейт
- вызываем его при маунте компонента

### Задача № 2

Написать запрос на добавление города:

- добавляем в стейт новове поле `action` с возможными значениями:

```
const ACTION = {
  NONE: 'none',
  ADD: 'add',
  EDIT: 'edit',
  DELETE: 'delete',
};
```

- теперь в стейте в activeCity будем хранить не имя активного города, а весь
  объект (для начала null)
- пишем новый метод confirmAdd, в котором принимаем имя нового города и
  устанавливаем в поле `action` 'add', а в activeCity объект с новым городом
- теперь этот метод будем передавать в AddForm
- в методе addCity делаем post-запрос и передаем, кроме ендпоинта, объект с
  новым городом
- полученный новый город добавляем в стейт в массив городов
- после любого ответа от сервера закрываем форму, сбрасываем поля `action` и
  `activeCity`
- в методе componentDidUpdate добавляем проверку: если предыдущий `action` не
  равен текущему и равен 'add', то вызываем метод addCity

### Задача № 3

Написать запрос на редактирование города:

- т.к. теперь в стейте в activeCity будем хранить не имя активного города, а
  весь объект, из ItemsList будем передаем в колбеки целый item, а не только имя
- соответсвенно, в EditCard теперь нужно передавать только имя активного города
- пишем новый метод confirmEdit, в котором принимаем измененное имя города и
  устанавливаем в поле `action` 'edit', а в activeCity обновляем имя, сохраняя
  айди
- теперь этот метод будем передавать в EditCard
- в методе editCity делаем put-запрос и передаем, кроме ендпоинта, объект с
  измененным именем
- полученный измененный город заменяем в стейте в массиве на новый
- после любого ответа от сервера закрываем модалку, сбрасываем поля `action` и
  `activeCity`
- в методе componentDidUpdate добавляем проверку: если предыдущий `action` не
  равен текущему и равен 'edit', то вызываем метод editCity

### Задача № 4

Написать запрос на удаление города:

- пишем новый метод confirmDelete, в котором устанавливаем в поле `action`
  'delete'
- в методе deleteCity делаем delete-запрос и передаем, кроме ендпоинта, айди
  активного города
- по айди из полученного удаленного города удаляем его из массива городов
- после любого ответа от сервера закрываем модалку, сбрасываем поля `action` и
  `activeCity`
- в методе componentDidUpdate добавляем проверку: если предыдущий `action` не
  равен текущему и равен 'delete', то вызываем метод deleteCity

### Задача № 5

Добавить [лоадер](https://www.npmjs.com/package/react-spinners) при запросах

- добавить в стейт новое поле loading, изначально false
- перед каждым апи-запросом устанавливать его значение в true
- после любого ответа от сервера устанавливать его значение снова в false
- импортим компонент Loader
- рендерим его, если в поле loading true

### Задача № 6

Добавить обработку ошибок при запросах:

### Задача № 7

Прерывать запрос во избежание утечки памяти при размонтировании компонента с
активным HTTP-запросом на примере запросов преподавателей

### Задача № 8

Добавить [скелетон](https://www.npmjs.com/package/react-content-loader) для
первой загрузки преподавателей

### Задача № 9

В компоненте преподавателей реализовать паттерн «State machine» для хранение
статуса запроса

### Задача № 10

В компоненте факультетов реализовать отображение уведомлений при удачных фетчах
используя библиотеку
[react-toastify](https://www.npmjs.com/package/react-toastify)

### Задача № 11

Перенести апи-урл в
[переменные окружения](https://create-react-app.dev/docs/adding-custom-environment-variables/#adding-development-environment-variables-in-env)

### Задача № 12

Переписать проверки в CitiesBlock в componentDidUpdate на switch
